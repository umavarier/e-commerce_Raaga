<%- include ('../layouts/header.ejs') %>
    <br>


    <div class="container-fluid">
        <div class="row px-xl-5">
            <div class="col-12">
                <nav class="breadcrumb mb-30">
                    <a style="color: white;" class="breadcrumb-item text-decoration-none" href="/home">Home</a>
                    <a class="breadcrumb-item text-decoration-none text-light" href="/loadCart">Cart</a>
                    <span class="breadcrumb-item active">Checkout</span>
                </nav>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->

    <style>
        .address-selection-card {
            background-color: #f2f2f2;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 2%;
            margin-left: 4%;
        }

        .address-selection-card h5 {
            margin-top: 0;
        }

        .address-selection-card label {
            display: block;
            margin-bottom: 10px;
            margin-left: 20px;
        }

        .address-selection-card input[type="radio"] {
            margin-right: 10px;
        }

        @media (min-width: 576px) {
            .address-selection-card {
                flex-basis: 48%;
            }
        }

        @media (min-width: 768px) {
            .address-selection-card {
                flex-basis: 31%;
            }
        }

        @media (min-width: 992px) {
            .address-selection-card {
                flex-basis: 23%;
            }
        }

        @media (min-width: 1200px) {
            .address-selection-card {
                flex-basis: 18%;
            }
        }
    </style>

    <br>
    <!-- Checkout Start -->

    <form action="/orderSuccess" method="post">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <h5 class="section-title text-uppercase mb-3">New Address</h5>
                    <div class="address-form p-4">
                        
                    <div class=" p-30">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="custom-control custom-checkbox" >
                                    <input  style="margin-left: 10px;" type="radio" name="address" id="addressid" value="0">
                                    <label class="text-dark" style="color:black;">Ship to different address</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="form-group">
                        <input class="form-control" type="text" name="firstname" placeholder="First Name">
                    </div>
                    <div class="form-group">
                        <input class="form-control" type="text" name="lastname" placeholder="Last Name">
                    </div>
                    <div class="form-group">
                        <input class="form-control" name="mno" type="text" placeholder="Phone">
                    </div>
                    <div class="form-group">
                        <input class="form-control" type="text" name="details" placeholder="Address">
                    </div>
                    <div class="form-row">
                        <div class="col-md-6 form-group">
                            <input class="form-control" type="text" name="country" placeholder="Country">
                        </div>
                        <div class="col-md-6 form-group">
                            <input class="form-control" type="text" name="city" placeholder="City">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="col-md-6 form-group">
                            <input class="form-control" type="text" name="state" placeholder="State">
                        </div>
                        <div class="col-md-6 form-group">
                            <input class="form-control" type="text" name="zip" placeholder="Postal Code">
                        </div>
                    </div>
                </div>
                                
                                <h5 style=" margin-right: 4%; color: black;"
                                    class="col-md-12 form-group section-title position-relative text-uppercase mb-3"><span class=" pr-3">Choose Address</span></h5>
                                <div >
                                    
                                    <div class="col-md-12">
                                        <!-- <div class="col-9 form-group d-flex justify-content"> -->
                                            <% for(i=0;i<address.length;i++){%>
                                                <div  style="color: white; background: #0b0c2a; border-color: rgb(76, 76, 76);"
                                                    class="address-selection-card col p-6 pb-4">
                                                    <input style="margin-left: 10px; margin-top: 5px;" type="radio" name="address" id="addressid"
                                                        value="<%=address[i]._id%>" <% if(i==0){%>checked<%}%> onchange="toggleAddressForm(this)">
                                                        <label>
                                                            <h6 style="color:white;">
                                                                Address <%=i+1%>
                                                            </h6>
                                                            <br>
                                                            <%=address[i].firstname%>
                                                                <%=address[i].lastname%>
                                                                    <br>
                                                                    <%=address[i].address%>
                                                                        <br>
                                                                        <%=address[i].state%>
                                                                            <br>
                                                                            <%=address[i].city%>
                                                                                <br>
                                                                                <%=address[i].country%>
                                                                                    <br>
                                                                                    <%=address[i].zip%>
                                                        </label>
                                                        
                                                        <div>
                                                            <a href="/editcheckoutAddress?id=<%=address[i]._id%>"><button
                                                                style="margin-top: 10px; margin-left: 5%; border-radius: 5px;" type="button"
                                                                class="btn-default">edit</button></a>
                                                                <a href="/deleteAddressCart?id=<%=address[i]._id%>"><button
                                                                    style="margin-top: 10px; margin-left: 5%;background-color: rgb(181, 57, 57); color: white; border-radius: 5px;" type="button"
                                                                    class="btn-default">delete</button></a>
                                                        </div>
                                                        
                                                </div>
                                                <%}%>
                                        </div>
                                    </div>
                                <hr>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>  
                
                    <hr>
                    <hr>
                    <h5 style="color: white;" class="section-title position-relative text-uppercase mb-3"><span
                            class=" pr-3" style="color:black;">Order Total</span></h5>
                    <div class=" p-30 mb-5">

                        <div class="border-bottom">
                            <h6 style="color: red;" id="msg"></h6>
                            <div style="color: white;" class="d-flex justify-content-between">
                                <h6 class="mb-3">Products</h6>
                                <h6 class="mb-3">Price</h6>
                            </div>
                            <% for(let key of checkoutdetails.item){ %>
                                <div class="d-flex justify-content-between text-light">
                                    <p class="text-uppercase">
                                        <%=key.productId.name%> x <%=key.qty%>
                                    </p>
                                    <p>
                                        <%=key.productId.price*key.qty%>
                                    </p>
                                </div>
                                <%}%>
                        </div>
                        <div class="border-bottom pt-3 pb-2">
                            <div class="d-flex justify-content-between mb-3">
                                <h6 style="color: white;">Subtotal</h6>
                                <input id="subTotal" value="<%=checkoutdetails.totalPrice%>" type="hidden">
                                <h6 style="color: rgb(255, 255, 255);">
                                    <%=checkoutdetails.totalPrice%>
                                </h6>
                            </div>
                            <div class="d-flex justify-content-between text-light">
                                <h6 class="font-weight-medium">Discount</h6>
                                <h6 id="dis" class="font-weight-medium">0</h6>
                            </div>
                            <div class="d-flex justify-content-between text-light">
                                <h6 class="font-weight-medium">Reduction Amount</h6>
                                <h6 id="amt" class="font-weight-medium">0</h6>
                            </div>


                        </div>
                        <div class="pt-2">

                            <div style="color: white;" class="d-flex justify-content-between mt-2">
                                <h5>Total</h5>
                                <h5 id="gT">Rs <%=checkoutdetails.totalPrice%>
                                </h5>

                                <input id="last" type="hidden" value="<%=checkoutdetails.totalPrice%>" name="amount">

                            </div>
                        </div>
                    </div>
                    <div class="mb-5 ">

                        

                        <h5 style="color: white;" class="section-title position-relative text-uppercase mb-3"><span
                                class=" pr-3">Payment</span></h5>
                        <div class=" p-30 text-light">
                            <div class="form-group">
                                <div class="custom-control custom-radio">
                                    <input type="radio" class="custom-control-input" checked name="payment" id="COD" value="COD"
                                        >
                                    <label class="custom-control-label" style="color:black;" for="COD">COD</label>
                                </div>
                            </div>                           
                        </div>

                            <button  style="height: 40px; align-items: center;" class="btn btn-block btn-primary font-weight-bold mt-3" type="submit">Place
                                Order</button>


                                
                        </div>
                    </div>

                </div>
            </div>
        
    </form>





    </div>

<!-- CSS styles -->
<style>
    .modal-content {
        background-color: black;
        color: white;
    }
</style>

<!-- Modal HTML -->

<!--model end-->
   
    <script>function confirmDelete(id) {
            if (confirm("Are you sure you want to delete this address?")) {
                window.location.href = "/deletecheckout-address?id=" + id;
            }
        }</script>

    
    <script>
        function copyText(id) {
            const textToCopy = document.getElementById(id).innerHTML;
            navigator.clipboard.writeText(textToCopy).then(() => {
                alert('Text copied successfully!');
                Swal.fire({
                    icon: 'success',
                    title: 'Coupon copied successfully!',
                    showConfirmButton: false,
                    timer: 1000
                });

            }, () => {
                // alert('Failed to copy text');
                Swal.fire({
                    icon: 'error',
                    title: 'Failed to copy',
                    showConfirmButton: false,
                    timer: 1000
                });

            });
        };

    </script>
    <script>
        // Get the radio button element
var addressRadio = document.getElementById('addressid');

// Get the form input elements
var firstNameInput = document.getElementsByName("firstname")[0];
var lastNameInput = document.getElementsByName("lastname")[0];
var phoneInput = document.getElementsByName("mno")[0];
var addressInput = document.getElementsByName("details")[0];
var countryInput = document.getElementsByName("country")[0];
var cityInput = document.getElementsByName("city")[0];
var stateInput = document.getElementsByName("state")[0];
var zipInput = document.getElementsByName("zip")[0];

// Add an event listener to the radio button
addressRadio.addEventListener("change", function() {
  // Check if the radio button is checked
  if (this.checked) {
    // Validate the form values
    var isValid = true;
    if (firstNameInput.value === "") {
      isValid = false;
      // Display an error message or perform any other validation logic
    }
    if (lastNameInput.value === "") {
      isValid = false;
      // Display an error message or perform any other validation logic
    }
    // Validate the rest of the form fields

    // If the form is not valid, you can prevent form submission by using:
    // event.preventDefault();

    // Example: Display a validation message if the form is not valid
    if (!isValid) {
      alert("Please fill in all the required fields.");
    }
  }
});

    </script>

    <script>

        
        function apply() {
            console.log("sample");
            cop = document.getElementById('coupon').value
            console.log(cop);
            subT = document.getElementById('subTotal').value
            console.log(subT);
            $.ajax({
                url: '/applyCoupon',
                type: 'POST',
                data: { coupon: cop, totalValue: subT },
                success: function (data) {
                    console.log(data);
                    if (data.state) {
                        total = subT - data.disc;
                        document.getElementById('dis').innerHTML = data.offerdata.discount + "%";
                        document.getElementById('amt').innerHTML = "Rs " + data.disc
                        document.getElementById('gT').innerHTML = total
                        // document.getElementById('final').value=total;
                        // console.log(  document.getElementById('final').value);
                        document.getElementById("payable").value = total;
                        console.log(data);
                    } else {
                        document.getElementById("msg").innerHTML = data.messag;
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log(textStatus, errorThrown);
                }
            });

        }

    </script>


    <%- include ('../layouts/footer.ejs') %>